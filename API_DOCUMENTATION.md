# Inner Scribe Vault - API Documentation

This document provides an overview of the custom API endpoints available in the Inner Scribe Vault application, built on the Supabase platform.

The primary API is auto-generated by Supabase based on the database schema. You can find detailed, interactive documentation for these standard table endpoints in your Supabase project dashboard under **API Docs**.

This document focuses on the custom Remote Procedure Calls (RPCs) created for specific application logic.

---

## RPC Functions

### 1. `global_search(search_term TEXT)`

This function performs a global, case-insensitive search across multiple tables in the database.

- **Method**: `POST`
- **Endpoint**: `/rest/v1/rpc/global_search`
- **Authorization**: Requires the `anon` key and the user's JWT.

#### Parameters

- `search_term` (text): The string to search for.

#### Request Body

```json
{
  "search_term": "your search query"
}
```

#### Response (200 OK)

Returns a `200 OK` status with a JSON array of search result objects.

```json
[
  {
    "id": "uuid-of-the-item",
    "type": "task" | "team",
    "title": "Title of the Task or Team",
    "description": "Description of the item",
    "url": "/tasks/uuid-of-the-item"
  }
]
```

---

### 2. `log_activity(...)`

This function is used internally by database triggers to log events to the `activity` table. It is not intended to be called directly by the client.

- **Security**: This function is defined with `SECURITY DEFINER` and is called by triggers on the `tasks` and `comments` tables. Direct client-side invocation is not recommended or supported.

#### Parameters
- `p_team_id` (UUID)
- `p_user_id` (UUID)
- `p_task_id` (UUID)
- `p_type` (TEXT)
- `p_metadata` (JSONB)

---

### 3. `is_member_of_team(team_id_to_check UUID)` and `is_admin_of_team(team_id_to_check UUID)`

These are helper functions used in Row Level Security (RLS) policies to check a user's membership and role within a team. They are not intended for direct client-side invocation.

- **Usage**: These functions are called within the `USING` and `WITH CHECK` clauses of RLS policies on tables like `tasks`, `team_members`, and `comments`.
- **Security**: They run with `SECURITY DEFINER` to safely query the `team_members` table without causing recursive RLS checks.

---

For standard table operations (CRUD on `tasks`, `teams`, etc.), please refer to the auto-generated documentation in your Supabase project dashboard. 